{%- style -%}
  .scroll-to-top-btn-{{ section.id }} {
    position: fixed;
    z-index: 99;
    /* Position logic based on settings */
    {% if section.settings.position == 'bottom-left' %}
      left: {{ section.settings.offset_x }}px;
      bottom: {{ section.settings.offset_y }}px;
    {% elsif section.settings.position == 'bottom-center' %}
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      bottom: {{ section.settings.offset_y }}px;
    {% else %}
      /* Default bottom-right */
      right: {{ section.settings.offset_x }}px;
      bottom: {{ section.settings.offset_y }}px;
    {% endif %}
    
    width: 50px;
    height: 50px;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease-in-out;
    transform: translateY(20px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    background-color: rgb(var(--color-button));
    color: rgb(var(--color-button-text));
  }

  .scroll-to-top-btn-{{ section.id }}.is-visible {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
    {% if section.settings.position == 'bottom-center' %}
      transform: translateX(-50%) translateY(0);
    {% endif %}
  }

  .scroll-to-top-btn-{{ section.id }} svg {
    width: 16px;
    height: 16px;
    fill: currentColor;
  }
  
  /* Mobile Adjustments */
  @media screen and (max-width: 749px) {
    .scroll-to-top-btn-{{ section.id }} {
      bottom: {{ section.settings.offset_y | times: 0.8 }}px;
      {% if section.settings.position == 'bottom-left' %}
        left: {{ section.settings.offset_x | times: 0.8 }}px;
      {% elsif section.settings.position == 'bottom-right' %}
        right: {{ section.settings.offset_x | times: 0.8 }}px;
      {% endif %}
    }
  }
{%- endstyle -%}

{% if section.settings.enable_scroll_btn %}
  <button
    id="ScrollToTop-{{ section.id }}"
    class="scroll-to-top-btn-{{ section.id }} color-{{ section.settings.color_scheme }} gradient"
    aria-label="Scroll to top"
    type="button"
  >
    <svg aria-hidden="true" focusable="false" role="presentation" class="icon" viewBox="0 0 14 14">
      <path fill="currentColor" d="M7 2.5a.5.5 0 0 1 .5.5v7.5a.5.5 0 0 1-1 0V3a.5.5 0 0 1 .5-.5z"/>
      <path fill="currentColor" d="M3.646 6.854a.5.5 0 0 1 .708 0L7 4.207l2.646 2.647a.5.5 0 0 1-.708.708L7 5.621 4.354 7.562a.5.5 0 0 1-.708-.708z"/>
      <path fill-rule="evenodd" clip-rule="evenodd" d="M7.354 3.646a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7 4.707l2.646 2.647a.5.5 0 0 0 .708-.708l-3-3z" fill="currentColor"></path>
    </svg>
  </button>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const scrollBtn = document.getElementById('ScrollToTop-{{ section.id }}');
      const displayAfter = {{ section.settings.display_after }};

      if (!scrollBtn) return;

      // Click event to scroll up
      scrollBtn.addEventListener('click', function() {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });

      // Scroll event to toggle visibility
      window.addEventListener('scroll', function() {
        if (window.scrollY > displayAfter) {
          scrollBtn.classList.add('is-visible');
        } else {
          scrollBtn.classList.remove('is-visible');
        }
      }, { passive: true });
    });
  </script>
{% endif %}

{% schema %}
{
  "name": "Scroll to Top Button",
  "limit": 1,
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_scroll_btn",
      "default": true,
      "label": "Enable button"
    },
    {
      "type": "range",
      "id": "display_after",
      "min": 0,
      "max": 1000,
      "step": 50,
      "unit": "px",
      "label": "Display after scrolling",
      "default": 300
    },
    {
      "type": "select",
      "id": "position",
      "options": [
        { "value": "bottom-left", "label": "Bottom left" },
        { "value": "bottom-center", "label": "Bottom center" },
        { "value": "bottom-right", "label": "Bottom right" }
      ],
      "default": "bottom-right",
      "label": "Position"
    },
    {
      "type": "range",
      "id": "offset_x",
      "min": 0,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Offset X",
      "default": 20
    },
    {
      "type": "range",
      "id": "offset_y",
      "min": 0,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Offset Y",
      "default": 20
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    }
  ],
  "presets": [
    {
      "name": "Scroll to Top Button"
    }
  ]
}
{% endschema %}